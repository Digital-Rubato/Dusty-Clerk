"""
# Directions and Next Ups

With Gui add:


done:
Add second input detailing the item ->
Second input to same dict ->
add enter/return button functionality instead of pressing ok->
save and export feature->
pressing ok or enter clears and saves the item description input line ->

Sprucing:
add visible data window->
add remove / delete button ->

Excel styling:

Expand columns and rows ->
Style them ->

""" 

""" Current Issues: 

did my code actually add barcode font styling???

why does my code dup values when powershell reads it back to me?

"""

import pandas as pd

from pandas.io.formats.style import Styler

import os

from openpyxl import load_workbook

import PySimpleGUI as sg

""" Data Space """

bc_style = []

transfer = []

item = []

cl = {}

""" Gui Logic """
#Variable Space

#layout window

layout = [
	[sg.Text('Dusty Clerk')],
	[sg.Text('Enter your barcode'), sg.InputText(do_not_clear=False)],
	[sg.Text('Item Details', size=(8,1)), sg.InputText()],
	[sg.Button('Add'), sg.Button('Save', key='save'), sg.Button('Exit')],
#adds invisible submit on enter press
	[sg.Button('Submit', visible=False, bind_return_key=True)]
	]

#Window Initialization
window = sg.Window('Dusty Clerk', layout)

#While loop to process 'events' and recieve values of the inputs

while True:
	event, values = window.read()
	
	if event == sg.WIN_CLOSED or event == 'Exit': 
		break
	
	if event == 'save':
		foldername = sg.PopupGetFolder('', no_window=True)
		filename = sg.PopupGetFile('Please enter a file name for your results')
		pathname = os.path.join(foldername ,filename + '.xlsx')
				
		f = open(pathname, 'w')
		f.close()
	
	if event == 'Add' or event == 'Submit':
		transfer.append(values[0])
		bc_style.append(f'*{values[0]}*')
		item.append(values[1])
		print(transfer)
		print(item)

window.close()

#add transfered values to dict

cl['Product ID'] = transfer
cl['Barcode'] = bc_style
cl['Item Description'] = item

""" Main Excel Logic """

#writing to demo.xslx and using xlsxwriter 'engine'
writer = pd.ExcelWriter(pathname, engine='xlsxwriter')

print("saving to: ",pathname)

#dataframe name and age columns
df = pd.DataFrame(cl)
print("Data Added to: ", pathname)

#styling DataFrame
print("styling dataframe")

def barcode_font(x):

	df = x.copy()

	df[['Barcode']] = 'font-family: Free 3 of 9'
	
	return df

df.style.apply(barcode_font, axis = None)

print("style complete")

#convert DataFrame to excel object
print("Inputting bulk data")

df.to_excel(writer, sheet_name='Sheet1', index=False)

#Saving and writing data
print("Saving")

writer.save()

print("Save Complete")

#read the data to check

print("Playback enabled")

reader = pd.read_excel(r'demo.xlsx')

print(reader)
print("Playback complete")